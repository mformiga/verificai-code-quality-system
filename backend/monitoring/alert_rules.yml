groups:
  - name: verificai-backend
    rules:
    - alert: HighErrorRate
      expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High error rate detected"
        description: "Error rate is {{ $value }} errors per second"

    - alert: HighResponseTime
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High response time detected"
        description: "95th percentile response time is {{ $value }} seconds"

    - alert: DatabaseConnectionHigh
      expr: pg_stat_database_numbackends > 80
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: "High database connections"
        description: "Database has {{ $value }} active connections"

    - alert: RedisMemoryHigh
      expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.8
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Redis memory usage high"
        description: "Redis is using {{ $value }}% of available memory"

    - alert: PodCPUHigh
      expr: rate(container_cpu_usage_seconds_total{container="verificai-backend"}[5m]) > 0.8
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High CPU usage"
        description: "Pod CPU usage is {{ $value }}"

    - alert: PodMemoryHigh
      expr: container_memory_usage_bytes{container="verificai-backend"} / container_spec_memory_limit_bytes{container="verificai-backend"} > 0.8
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High memory usage"
        description: "Pod memory usage is {{ $value }}%"

    - alert: ServiceDown
      expr: up{job="verificai-backend"} == 0
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "Service is down"
        description: "VerificAI backend service is not responding"